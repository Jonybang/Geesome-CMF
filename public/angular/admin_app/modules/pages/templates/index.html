<div layout="row">
    <md-sidenav layout="column" class="md-background md-hue-2 padding" md-is-locked-open="true" flex="15">

        <div ng-repeat="context in contexts">
            <h4>{{context.name}}</h4>
            <div class="btn-group btn-group-justified">
                <div class="btn-group" role="group">
                    <a class="btn btn-default btn-sm" ui-sref="app.page.edit({pageId: null, context_id: context.id})"><span class="glypicon glyphicon-plus"></span> Add page</a>
                </div>
            </div>

            <ul dnd-list="context.pages_tree"
                dnd-drop="changeParent(event, index, item, {id: 0})"
                class="list-unstyled margin-top">
                <li ng-repeat="page in context.pages_tree"
                    dnd-draggable="page"
                    dnd-effect-allowed="move"
                    dnd-moved="context.pages_tree.splice($index, 1)"
                    dnd-selected="models.selected = page"
                    ng-class="{selected: models.selected === page}"
                    ng-include="'list.html'"
                    ui-sref="app.page.edit({pageId: page.id})">
                </li>
            </ul>
            <md-divider></md-divider>
        </div>

    </md-sidenav>

    <md-card layout="column" flex="85">
        <ui-view></ui-view>
    </md-card>
</div>

<script type="text/ng-template" id="list.html">
    <a href ng-click="page.hide_children = !page.hide_children" >{{page.title}}</a>
    <ul dnd-list="page.child_pages_by_index"
        dnd-drop="changeParent(event, index, item, page)"
        ng-class="['child_pages', {'empty':!page.child_pages_by_index.length}]">
        <li ng-repeat="page in page.child_pages_by_index"
            dnd-draggable="page"
            dnd-effect-allowed="move"
            dnd-moved="$parent.$parent.page.child_pages_by_index.splice($index, 1)"
            dnd-selected="models.selected = page"
            ng-class="{selected: models.selected === page}"
            ng-include="'list.html'"
            ui-sref="app.page.edit({pageId: page.id})">
        </li>
    </ul>
</script>